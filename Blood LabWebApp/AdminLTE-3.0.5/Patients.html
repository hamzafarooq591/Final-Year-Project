<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Alpha Lab Admin Panel</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

  <style>
    .tableColumnWidth{
      width: 20%;
    }
    
    [class*=sidebar-dark-] {
    background-color: #143e89;
}
.card-primary:not(.card-outline)>.card-header {
    background-color:#ff0107;
}
.btn-primary {
    color: #fff;
    background-color:#ff0107;
    border-color:#ff0107;
    box-shadow: none;
}
.btn-secondary {
    color: #fff;
    background-color: #ff0107;
    border-color: #ff0107;
    box-shadow: none;
}
.btn-primary :hover{
  background-color: black;
}

#overlay {
      position: absolute;
      /* Sit on top of the page content */
      display: none;
      /* Hidden by default */
      width: 100%;
      /* Full width (cover the whole page) */
      height: 298%;
      /* Full height (cover the whole page) */
      top: 0;
      left: 0;
      right: 0;
      bottom: 0px;
      background-color: rgba(0, 0, 0, 0.5);
      /* Black background with opacity */
      z-index: 2;
      /* Specify a stack order in case you're using a different order for other elements */
      cursor: pointer;
      /* Add a pointer on hover */
    }
  </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
  
  <div id="overlay"> 
    <section class="content" style="margin-top: 85px;" id="displayEditDiv">

         <div class="container-fluid">
        <div class="row" style="justify-content: center;">
          <!-- left column -->
          <div class="col-md-6">
            <!-- general form elements -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">Edit Patient</h3>
              </div>
              <div class="col-sm-4">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="file:///D:/bloodlabwebapp/AdminLTE-3.0.5/dashboard.html">Dashboard</a></li>
                  <li class="breadcrumb-item active">Patient</li>
                </ol>
              </div>
              <!-- /.card-header -->
              <!-- form start -->
              <div role="form">
                <div class="card-body">
                  <div class="form-group">
                    <label for="txtEditFullName">Full Name</label>
                    <input type="text" class="form-control" id="txtEditFullName" placeholder="fullName">
                  </div>
                  <div class="form-group">
                    <label for="Gender">Gender</label>
                    <select class="form-control select2" id="Gendertxtedit" style="width: 100%;">
                      <option value="">---SELECT YOUR Gender---</option>
                      <option value="Male"> Male</option>
                      <option value="Female"> Female</option>
                    </select>
                  </div>                
                  <div class="form-group">
                    <label for="txtEditAddress">Address</label>
                    <input type="text" class="form-control" id="txtEditAddress" placeholder="Address">
                  </div>
                  <div class="form-group">
                    <label for="txtEditPhoneNumber">Phone Number</label>
                    <input type="phonenumber" class="form-control" id="txtEditPhoneNumber" placeholder="Phone Number">
                  </div>
                  <div class="form-group">
                    <label for="txtEditPassword">Password</label>
                    <input type="password" class="form-control" id="txtEditPassword" placeholder="Password">
                  </div>
                  <div class="form-group">
                    <label for="txtEditEmail">Email</label>
                    <input type="Email" class="form-control" id="txtEditEmail" placeholder="Email">
                  </div>
                  <fieldset disabled>
                    <div class="form-group">
                      <label for="txtEditCountry">Country</label>
                      <input type="text" id="txtEditCountry" class="form-control" placeholder="Pakistan">
                    </div>
                    <div class="form-group">
                      <label for="txtEditCity">City</label>
                      <input type="text" id="txtEditCity" class="form-control" placeholder="Karachi">
                    </div>
                    <div class="form-group">
                      <label for="txtEditProvince">Province</label>
                      <input type="text" id="txtEditProvince" class="form-control" placeholder="Sindh">
                    </div>
                  </fieldset>
                  <div>
                    <button type="submit" class="btn btn-primary px-5" onclick="SaveForm('')">Update</button>
                  </div>
                </div>
              </div>
            </div>
            <!-- /.card -->
          </div>
        </div><!-- /.container-fluid -->
    </section>
  </div>


<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <!-- <li class="nav-item d-none d-sm-inline-block">
        <a href="index3.html" class="nav-link">Home</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="#" class="nav-link">Contact</a>
      </li> -->
    </ul>
    <div class="float-right l-3"  style="width: 100%; text-align: right;">
      <button type="submit" class="btn btn-primary px-4 ml-2" onclick="logout()"><i"> <i class="fas fa-sign-out-alt" style="width: 40px; height:20px;"></i></i></button>
        
        </div>
    <!-- SEARCH FORM -->
    <!-- <form class="form-inline ml-3">
      <div class="input-group input-group-sm">
        <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
        <div class="input-group-append">
          <button class="btn btn-navbar" type="submit">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
    </form> -->
  </nav>
  <!-- /.navbar -->

  <aside  class="main-sidebar sidebar-dark-primary elevation-4">
    <div id="sideBarContent"> 

  </div>
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Patients</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="file:///D:/bloodlabwebapp/AdminLTE-3.0.5/dashboard.html">Dashboard </a></li>
              <li class="breadcrumb-item  active">Patient</li>
            </ol>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <!-- left column -->
          <div class="col-md-12">
            <!-- general form elements -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">Add Patient</h3>
              </div>
              <!-- /.card-header -->
              <!-- form start -->
              <div role="form">
                <div class="card-body">
                  <div class="form-group">
                    <label for="txtFullName">Full Name</label>
                    <input type="text" class="form-control" id="txtFullName" placeholder="fullName">
                  </div>
                  <div class="form-group">
                    <label for="Gender">Gender</label>
                    <select class="form-control select2" id="Gendertxt" style="width: 100%;">
                      <option>---SELECT YOUR Gender---</option>
                      <option value="Male"> Male</option>
                      <option value="Female"> Female</option>
                    </select>
                  </div>
                  <div class="form-group">
                        <label for="txtAddress">Address</label>
                        <input type="text" class="form-control" id="txtAddress" placeholder="Address">
                  </div>
                  <div class="form-group">
                        <label for="txtPhoneNumber">Phone Number</label>
                        <input type="phonenumber" class="form-control" id="txtPhoneNumber" placeholder="Phone Number">
                  </div>
                  <div class="form-group">
                        <label for="txtPassword">Password</label>
                        <input type="password" class="form-control" id="txtPassword" placeholder="Password">
                  </div>
                  <div class="form-group">
                        <label for="txtEmail">Email</label>
                        <input type="Email" class="form-control" id="txtEmail" placeholder="Email">
                  </div>
                  <fieldset disabled>
                    <div class="form-group">
                          <label for="txtCountry">Country</label>
                          <input type="text" id="txtCountry" class="form-control" placeholder="Pakistan">
                    </div>
                    <div class="form-group">
                          <label for="txtCity">City</label>
                          <input type="text" id="txtCity" class="form-control" placeholder="Karachi">
                    </div>
                    <div class="form-group">
                          <label for="txtProvince">Province</label>
                          <input type="text" id="txtProvince" class="form-control" placeholder="Sindh">
                    </div>
                    <input type="hidden" id="hiddenIDNew">
                  </fieldset> 
                  <div>
                    <button type="button" class="btn btn-primary px-5" onclick="SaveForm('add')">Add</button>
                  </div>   
                </div>
            
                <!-- /.card-body -->

              
              </div>
            </div>
            <!-- /.card -->
          </div>
        </div><!-- /.container-fluid -->
   

    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Patient List</h3>

            <div class="card-tools">
              <div class="input-group input-group-sm" style="width: 150px;">
                <input type="text" name="table_search" class="form-control float-right" placeholder="Search">

                <div class="input-group-append">
                  <button type="submit" class="btn btn-default"><i class="fas fa-search"></i></button>
                </div>
              </div>
            </div>
          </div>
          <!-- /.card-header -->
         
          <div class="card-body table-responsive p-0">
            <table class="table table-hover text-nowrap">
              <thead>
              
              <tr>
                  <th class="tableColumnWidth">ID</th>
                  <th class="tableColumnWidth">Patient Number</th>
                  <th class="tableColumnWidth">Full Name</th>
                  <th class="tableColumnWidth">Active</th>
                  <th class="tableColumnWidth" style="text-align: center;">Action</th>
                </tr>
              </thead>
              <tbody id="patientTableBody">
               
              </tbody>
            </table>
          </section>
          </div>
        </div>
       </div>
    </div>
  </div>
</div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <div class="float-right d-none d-sm-block">
      <!-- <b>Version</b> 3.0.5 -->
    </div>
    <strong>Copyright &copy; 2021<a href="https://nash.pk/">NASH</a>.</strong> All rights
    reserved.
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<script src="plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- bs-custom-file-input -->
<script src="plugins/bs-custom-file-input/bs-custom-file-input.min.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<script src="dist/js/pages/fixContent.js"></script>
<script type="text/javascript">
 var nashApi = "localhost:49988";
var ta = [];
    var rowCounter = 0;
    var currentPage = 1;
    var rowSize = 100;
    var totalPages = 0;
    var companyIdForBranch;
    var rowData = '';
    var tokenValue = localStorage.getItem("SessionKeyFromLogin"); 

    $(document).ready(function () {
      fillList();
    });

    function resetMaster(){
      document.getElementById('txtFullName').value = "";
      document.getElementById('txtAddress').value = "";
      document.getElementById('txtPhoneNumber').value = "";
      document.getElementById('txtPassword').value = "";
      document.getElementById('txtEmail').value = "";
      document.getElementById('Gendertxt').value = "";
    }

    function SaveForm(mode) {
        var id = 0;
        var formData = "";
        if (mode == ""){
            id = document.getElementById('hiddenIDNew').value;
            debugger;
            formData = {
              patientId: id,
              fullName: document.getElementById('txtEditFullName').value,
              address: document.getElementById('txtEditAddress').value,
              phoneNumber: document.getElementById('txtEditPhoneNumber').value,
              gender:$('#Gendertxtedit').val(),
              password: document.getElementById('txtEditPassword').value,
              email: document.getElementById('txtEditEmail').value,
              country: document.getElementById('txtEditCountry').value,
              city: document.getElementById('txtEditCity').value,
              province: document.getElementById('txtEditProvince').value,
              isVerified: true,
              isActive: true,
              verificationCode: "string",
              createdBy: "string",
              dateCreated: "string",
              dateModified: "string",
              lastModified: "string"
            };
        }
        else{
          debugger
          formData = {
              patientId: id,
              fullName: document.getElementById('txtFullName').value,
              address: document.getElementById('txtAddress').value,
              phoneNumber: document.getElementById('txtPhoneNumber').value,
              gender:$('#Gendertxt').val(),
              password: document.getElementById('txtPassword').value,
              email: document.getElementById('txtEmail').value,
              country: document.getElementById('txtCountry').value,
              city: document.getElementById('txtCity').value,
              province: document.getElementById('txtProvince').value,
              isVerified: true,
              isActive: true,
              verificationCode: "string",
              createdBy: "string",
              dateCreated: "string",
              dateModified: "string",
              lastModified: "string"
            };
        }
        var URL = '';
        debugger;
        if (id > 0) {
            URL = 'http://'+nashApi+'/api/Patient/Put/'+ id;
        }
        else {
            URL = 'http://'+nashApi+'/api/Patient/Post';
        }
        $.ajax({
            url: URL,
            type: 'POST',
            dataType: 'json',
            headers: { 'token': tokenValue },
            data: formData,
            success: function (data) {
                var value = data.data;
              fillList();
                overlayOff();
                resetMaster();
            },
            error: function (request, message, error) {
                console.log("error", error);
                overlayOff();
            }
        });
        //Reset form
    }

    function fillList() {
        var URL = 'http://' + nashApi + '/api/Patient?Size=' + rowSize + "&page=" + currentPage;
        debugger;
        $.ajax({
            url: URL,
            type: 'GET',
            datatype: 'json',
            headers: { 'token': tokenValue },
            success: function (data) {
                console.log(data);
                var OfferTableBody = document.getElementById('patientTableBody');
                if (data.pageCount == 0) {
                    OfferTableBody.innerHTML = '<td colspan="4">No Record Found</td>';
                }
                else {
                    OfferTableBody.innerHTML = '';
                }
                totalPages = data.pageCount;
                $.each(data.data, function (index, value) {
                    var tableRow = document.createElement("tr");
                    var tableCol = document.createElement("td");

                    tableCol.innerHTML = value.patientId;
                    tableRow.appendChild(tableCol);

                    tableCol = document.createElement("td");
                    tableCol.innerHTML = value.phoneNumber;
                    tableRow.appendChild(tableCol);
                    tableCol = document.createElement("td");
                    tableCol.innerHTML = value.fullName;
                    tableRow.appendChild(tableCol);

                    tableCol = document.createElement("td");
                    if (value.isActive)
                      tableCol.innerHTML = '<input type="checkbox" name="" value="" onchange="activatePatient('+ value.patientId +',this)" checked id="">'; 
                    else
                      tableCol.innerHTML = '<input type="checkbox" name="" value="" onchange="activatePatient('+ value.patientId +',this)" id="">'; 
                    
                    tableRow.appendChild(tableCol);

                    var buttons = '<button type="button" style="margin-right:5px" class="btn btn-primary px-5 ml-3" onclick="editRow(' + value.patientId + ')"><i class="fa fa-edit"></i></button><button type="button" class="btn btn-secondary px-5" onclick="delRecord(' + value.patientId + ')"><i class="fa fa-trash "></i></button>';
                    tableCol = document.createElement("td");
                    tableCol.innerHTML = buttons;
                    tableRow.appendChild(tableCol);
                    OfferTableBody.append(tableRow);
                });
                // document.getElementById("pagerText").innerHTML = "Page " + currentPage + " of " + totalPages;
            },
            error: function (request, message, error) {
                console.log(error);
            }
        });
    }

    function activatePatient(recordId,isActiveCheckBox)
    {
     // alert(isActiveCheckBox.checked);

      if (confirm('Are you sure you want to change the status of this record') == false)
        {
            return;
        }
        $.ajax({
            url: 'http://' + nashApi + '/api/Patient/Activate/' + recordId+'?isActive='+isActiveCheckBox.checked,
                type: 'POST',
                headers: { 'token': tokenValue },
                success: function (data) {
                  fillList();
                },
                error: function (request, message, error) {
                    console.log(error);
                }
            });
    }

    function delRecord(recordId) {
        if (confirm('Are you sure you want to delete this record') == false)
        {
            return;
        }
        $.ajax({
            url: 'http://' + nashApi + '/api/Patient/Delete/' + recordId,
                type: 'POST',
                headers: { 'token': tokenValue },
                success: function (data) {
                    fillList();
                },
                error: function (request, message, error) {
                    console.log(error);
                }
            });
    }

    function editRow(recordId) {
      debugger
      overlayOn();
      document.getElementById('displayEditDiv').style.display = "block";
      setupForm(recordId);

    }

    function setupForm(recordId) {
      debugger
        //var loc = window.location;
        var recId = recordId;
        if (recId > 0) {
            getRecord(recId);
        }
    }
    function getRecord(recId) {
        $.ajax({
            url: 'http://' + nashApi + '/api/Patient/' + recId, //get
            type: 'GET',
            dataType: 'json',
            headers: { 'token': tokenValue },
            success: function (data) {
                debugger;
                value = data.data;
                document.getElementById('txtEditFullName').value = value.fullName;
                document.getElementById('Gendertxtedit').value = value.gender;
                document.getElementById('txtEditAddress').value = value.address;
                document.getElementById('txtEditPhoneNumber').value = value.phoneNumber;
                document.getElementById('txtEditPassword').value = value.password;
                document.getElementById('txtEditEmail').value = value.email;
                document.getElementById('hiddenIDNew').value = value.patientId;

            },
            error: function (request, message, error) {
                console.log(error);
            }
        });
    }

</script>

</body>
</html>
