<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Alpha Lab Admin Panel</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <style>
    .tableColumnWidth {
      width: 20%;
    }

    [class*=sidebar-dark-] {
      background-color: #143e89;
    }

    .card-primary:not(.card-outline)>.card-header {
      background-color: #ff0107;
    }

    .btn-primary {

      background-color: #ff0107;
      border-color: #ff0107;

    }

    .btn-secondary {

      background-color: #ff0107;
      border-color: #ff0107;

    }

    #overlay {
      position: fixed;
      /* Sit on top of the page content */
      display: none;
      /* Hidden by default */
      width: 100%;
      /* Full width (cover the whole page) */
      height: 100%;
      /* Full height (cover the whole page) */
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      /* Black background with opacity */
      z-index: 2;
      /* Specify a stack order in case you're using a different order for other elements */
      cursor: pointer;
      /* Add a pointer on hover */
    }
  </style>
</head>

<body class="hold-transition sidebar-mini layout-fixed">
  <div id="overlay"  >
    <section class="content" style="margin-top: 85px" id="displayEditDiv">
      <input type="hidden" id="hiddenID">
      <div class="container-fluid">
        <div class="row" style="justify-content: center;">
          <!-- left column -->
          <div class="col-md-6">
            <!-- general form elements -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">Edit Lab Test</h3>
              </div>
              <div class="col-sm-4">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="file:///D:/bloodlabwebapp/AdminLTE-3.0.5/dashboard.html">Dashboard</a></li>
                  <li class="breadcrumb-item active">Lab Test</li>
                </ol>
              </div>
              <!-- /.card-header -->
              <!-- form start -->
              <div role="form">
                <div class="card-body">
                  <div class="form-group">
                    <label for="txtEditTestName">Test Name</label>
                    <input type="Text" class="form-control" id="txtEditTestName" placeholder="Enter Test Name">
                  </div>
                  <div class="form-group">
                    <label for="txtEditTestCode">Test Code</label>
                    <input type="number" class="form-control" id="txtEditTestCode" placeholder="Enter Test Code">
                  </div>
                  <div class="form-group">
                    <label for="txtEditDesciption">Description</label>
                    <input type="text" class="form-control" id="txtEditDesciption" placeholder="Enter Description">
                  </div>
                  <div class="form-group">
                    <label for="txtEditPrice">Price</label>
                    <input type="number" class="form-control" id="txtEditPrice" placeholder="Enter Price">
                  </div>
                  <div>
                    <button type="button" class="btn btn-primary px-5" onclick="SaveForm('')">Update</button>
                  </div>
                </div>
              </div>
            </div>
            <!-- /.card -->
          </div>
        </div><!-- /.container-fluid -->
    </section>
  </div>
  
  <div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <!-- <li class="nav-item d-none d-sm-inline-block">
          <a href="index3.html" class="nav-link">Home</a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="#" class="nav-link">Contact</a>
        </li> -->

      </ul>
<div class="float-right l-3"  style="width: 100%; text-align: right;">
      <button type="submit" class="btn btn-primary px-4 ml-2" onclick="logout()"><i"> <i class="fas fa-sign-out-alt" style="width: 40px; height:20px;"></i></i></button>
        
        </div>
      <!-- SEARCH FORM -->
      <!-- <form class="form-inline ml-3">
        <div class="input-group input-group-sm">
          <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
          <div class="input-group-append">
            <button class="btn btn-navbar" type="submit">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
      </form> -->
    </nav>
    <!-- /.navbar -->

    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <div id="sideBarContent">

      </div>
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1>Lab Test</h1>
            </div>
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="file:///D:/bloodlabwebapp/AdminLTE-3.0.5/dashboard.html">Dashboard </a></li>
                <li class="breadcrumb-item active">Lab Test</li>
              </ol>
            </div>
          </div>
        </div><!-- /.container-fluid -->
      </section>

      <!-- Main content -->
      <section class="content">
        <div class="container-fluid">
          <div class="row">
            <!-- left column -->
            <div class="col-md-12">
              <!-- general form elements -->
              <div class="card card-primary">
                <div class="card-header">
                  <h3 class="card-title">Lab Test</h3>
                </div>
                <!-- /.card-header -->
                <!-- form start -->
                <div role="form">
                  <div class="card-body">
                    <div class="form-group">
                      <label for="txtTestName">Test Name</label>
                      <input type="Text" class="form-control" id="txtTestName" placeholder="Enter Test Name">
                    </div>
                    <div class="form-group">
                      <label for="txtTestCode">Test Code</label>
                      <input type="number" class="form-control" id="txtTestCode" placeholder="Enter Test Code">
                    </div>
                    <div class="form-group">
                      <label for="txtDesciption">Description</label>
                      <input type="text" class="form-control" id="txtDesciption" placeholder="Enter Description">
                    </div>
                    <div class="form-group">
                      <label for="txtPrice">Price</label>
                      <input type="number" class="form-control" id="txtPrice" placeholder="Enter Price">
                    </div>
                    <div>
                      <button type="button" class="btn btn-primary px-5" onclick="SaveForm('add')">Add</button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- /.card -->
            </div>
          </div><!-- /.container-fluid -->
    

      

      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Test List</h3>

              <div class="card-tools">
                <div class="input-group input-group-sm" style="width: 150px;">
                  <input type="text" name="table_search" class="form-control float-right" placeholder="Search">

                  <div class="input-group-append">
                    <button type="submit" class="btn btn-default"><i class="fas fa-search"></i></button>
                  </div>
                </div>
              </div>
            </div>
            <!-- /.card-header -->
            <div class="card-body table-responsive p-0">
              <table class="table table-hover text-nowrap">
                <thead>
                  <tr>
                    <th class="tableColumnWidth">ID</th>
                    <th class="tableColumnWidth">Test Code</th>
                    <th class="tableColumnWidth">Test Name</th>
                    <th class="tableColumnWidth">Price</th>
                    <th class="tableColumnWidth" style="text-align: center;">Action</th>
                  </tr>
                </thead>
                <tbody id="labTestTableBody">

                </tbody>
              </table>
            </div>
            <!-- /.card-body -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
    <!-- /.content-wrapper -->
    <footer class="main-footer">
      <div class="float-right d-none d-sm-block">
        <!-- <b>Version</b> 3.0.5 -->
      </div>
      <strong>Copyright &copy; 2021<a href="https://nash.pk/">NASH</a>.</strong> All rights
      reserved.
    </footer>

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
      <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
  </div>
  <!-- ./wrapper -->

  <!-- jQuery -->
  <script src="plugins/jquery/jquery.min.js"></script>
  <!-- Bootstrap 4 -->
  <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- bs-custom-file-input -->
  <script src="plugins/bs-custom-file-input/bs-custom-file-input.min.js"></script>
  <!-- AdminLTE App -->
  <script src="dist/js/adminlte.min.js"></script>
  <!-- AdminLTE for demo purposes -->
  <script src="dist/js/demo.js"></script>
  <script src="dist/js/pages/fixContent.js"></script>
  <script type="text/javascript">
    $(document).ready(function(){
        fillList();
    });
    
    var ta = [];
    var rowCounter = 0;
    var currentPage = 1;
    var rowSize = 100;
    var totalPages = 0;
    var companyIdForBranch;
    var rowData = '';
    var tokenValue = localStorage.getItem("SessionKeyFromLogin"); 

    function addRow() {
      if (document.getElementById('txtTestName').value != 0 && document.getElementById('txtTestCode').value != 0
        && document.getElementById('txtDesciption').value != 0 && document.getElementById('txtPrice').value != 0) {
        var table = document.getElementById("labTestTableBody");
        var row = table.insertRow(0);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var TestName = document.getElementById('txtTestName').value;
        var TestCode = document.getElementById('txtTestCode').value;
        var Desciption = document.getElementById('txtDesciption').value
        var Price = document.getElementById('txtPrice').value
        cell1.innerHTML = TestName;
        cell2.innerHTML = TestCode
        cell3.innerHTML = Desciption;
        cell4.innerHTML = Price;
        cell5.innerHTML = '<td><div><button style="margin-right:5px" class="btn btn-primary px-5 ml-3" onclick="editRow()"><i class="fa fa-edit"></i></button><button onclick="deleteRow(this)" class="btn btn-secondary px-5"><i class="fa fa-trash "></i></button></div></td>';
        rowCounter = rowCounter + 1;
      }
      else {
        alert('Please Fill all values for Adding an Item');
      }
    }
    
    function editRow(recordId) {
      overlayOn();
      document.getElementById('displayEditDiv').style.display = "block";
      setupForm(recordId);

    }

    function setupForm(recordId) {
        //var loc = window.location;
        recId = recordId;
        if (recId > 0) {
            getRecord(recId);
        }
    }
    function getRecord(recId) {
        $.ajax({
            url: nashApi + '/api/Test/' + recId, //get
            type: 'GET',
            dataType: 'json',
            headers: { 'token': tokenValue },
            success: function (data) {
                debugger;
                value = data.data;
                document.getElementById('hiddenID').value = value.testId;
                document.getElementById('txtEditTestName').value = value.title;
                document.getElementById('txtEditTestCode').value = value.code;
                document.getElementById('txtEditDesciption').value = value.description;
                document.getElementById('txtEditPrice').value = value.price;
                //document.getElementById('txtItempurchaseprice').value = Item.purchasePrice;

            },
            error: function (request, message, error) {
                console.log(error);
            }
        });
    }

    function SaveForm(mode) {
        debugger;
        var id = 0;
        var formData = "";
        if (mode == "")
        {
            id = document.getElementById('hiddenID').value;
            formData = {
                testId: id,
              code: document.getElementById('txtEditTestCode').value,
              title: document.getElementById('txtEditTestName').value,
              price: document.getElementById('txtEditPrice').value,
              description: document.getElementById('txtEditDesciption').value
              };
        }
        else
        {
          formData = {
            testId: id,
            code: document.getElementById('txtTestCode').value,
            title: document.getElementById('txtTestName').value,
             price: document.getElementById('txtPrice').value,
            description: document.getElementById('txtDesciption').value
        };

        }

        var URL = '';
        
        debugger;
        if (id > 0) {
            URL = nashApi+'/api/Test/Put/'+ id;
        }
        else {
            URL = nashApi+'/api/Test/Post';
        }

        $.ajax({
            url: URL,
            type: 'POST',
            dataType: 'json',
            headers: { 'token': tokenValue },
            data: formData,
            success: function (data) {
                //debugger;
                var value = data.data;
                fillList();
                overlayOff();
                resetMaster();
            },

            error: function (request, message, error) {

                console.log("error", error);
                overlayOff();
            }
        });
        //Reset form
    }

    function delRecord(recordId) {
        if (confirm('Are you sure you want to delete this record') == false)
        {
            return;
        }
        $.ajax({
            url: nashApi + '/api/Test/Delete/' + recordId,
                type: 'POST',
                headers: { 'token': tokenValue },
            success: function (data) {
                    fillList();
                },
                error: function (request, message, error) {
                    console.log(error);
                }
            });
    }

    function resetMaster(){
      document.getElementById('txtTestName').value = '';
      document.getElementById('txtTestCode').value = "";
      document.getElementById('txtPrice').value ='';
      document.getElementById('txtDesciption').value = "";
    }

    var itemStockQuantity = [];
    var itemBasePrice = [];

    function ListDetails() {
      var table = document.getElementById('labTestTableBody');
      var rowcounter = table.rows.length;
      //var cellcounter = table.rows[0].cells.length;
      debugger;
      var td = '[';
      for (i = 0; i < rowcounter; i++) {
        td += '{"itemSaleDetailId": 0,"itemId": ' + table.rows[i].cells[0].children[0].value;
        td += ',"itemSaleMasterId": 0,"itemQuantity": ' + table.rows[i].cells[1].innerText;
        td += ',"itemSellPrice": ' + table.rows[i].cells[2].innerText;
        td += ',"itemTotalAmount": ' + table.rows[i].cells[3].innerText + '}';
        if (i < rowcounter - 1) {
          td += ','
          ta[i] = td;
          rowData += td;
          td = '';
        }
        else {
          td += ']'
          ta[i] = td;
          rowData += td;
          td = '';
        }
      }
    }

    function fillList() {
        var URL = nashApi + '/api/Test?size=' + rowSize + "&page=" + currentPage;
        
        $.ajax({
            url: URL,
            type: 'GET',
            datatype: 'json',
            headers: { 'token': tokenValue },
            success: function (data) {
                console.log(data);
                var LabTestTableBody = document.getElementById('labTestTableBody');
                if (data.pageCount == 0) {
                    LabTestTableBody.innerHTML = '<td colspan="4">No Record Found</td>';
                }
                else {
                    LabTestTableBody.innerHTML = '';
                }
                totalPages = data.pageCount;
                $.each(data.data, function (index, value) {
                    var tableRow = document.createElement("tr");
                    var tableCol = document.createElement("td");

                    tableCol.innerHTML = value.testId;
                    tableRow.appendChild(tableCol);

                    tableCol = document.createElement("td");
                    tableCol.innerHTML = value.code;
                    tableRow.appendChild(tableCol);

                    tableCol = document.createElement("td");
                    tableCol.innerHTML = value.title;
                    tableRow.appendChild(tableCol);

                    tableCol = document.createElement("td");
                    tableCol.innerHTML = value.price;
                    tableRow.appendChild(tableCol);

                    var buttons = '<button type="button" style="margin-right:5px" class="btn btn-primary px-5 ml-3" onclick="editRow(' + value.testId + ')"><i class="fa fa-edit"></i></button><button type="button" class="btn btn-secondary px-5" onclick="delRecord(' + value.testId + ')"><i class="fa fa-trash "></i></button>';
                    tableCol = document.createElement("td");
                    tableCol.innerHTML = buttons;
                    tableRow.appendChild(tableCol);
                    LabTestTableBody.append(tableRow);
                });
                // document.getElementById("pagerText").innerHTML = "Page " + currentPage + " of " + totalPages;
            },
            error: function (request, message, error) {
                console.log(error);
            }
        });
    }
    // function resetMaster() {
    //   document.getElementById('ddlContact').selectedIndex = 0;
    //   getDate();
    //   document.getElementById('purchaseOrderTotalid').value = 0;
    //   document.getElementById('descriptionid').value = "";
    //   document.getElementById('ItemPurchaseDetailTableBody').innerHTML = "";
    // }

    // function SaveForm() {
    //   showloader();
    //   debugger;
    //   if (document.getElementById('ItemPurchaseDetailTableBody').innerText != "") {
    //     if (document.getElementById('ddlContact').selectedIndex != 0 &&
    //       document.getElementById('poDate').value != 0) {
    //       var id = 0;
    //       id = document.getElementById('hdnId').value;
    //       var URL = '';
    //       var ListDetail = document.getElementById('ItemPurchaseDetailTableBody');
    //       ListDetails();
    //       var rowDataJson = JSON.parse(rowData);
    //       gstAmount = document.getElementById('txtgstTotal').value,
    //         gstAmount = formatNumber(gstAmount);
    //       var formData = {
    //         itemSaleMasterId: id,
    //         contactId: document.getElementById('ddlContact').value,
    //         description: document.getElementById('descriptionid').value,
    //         totalAmount: document.getElementById('txtTotalAmount').value,
    //         gstAmount: gstAmount,
    //         gstPercentage: gstperc,
    //         isPaid: true,
    //         saleOrderDate: document.getElementById('poDate').value,
    //         itemSaleDetailList: rowDataJson,
    //       };
    //       debugger;
    //       if (id > 0) {
    //         URL = 'http://' + nash + '/api/ItemSaleMaster/Put/' + id;
    //       }
    //       else {
    //         URL = 'http://' + nash + '/api/ItemSaleMaster';
    //       }

    //       $.ajax({
    //         url: URL,
    //         type: 'POST',
    //         dataType: 'json',
    //         headers: { 'token': tokenValue },
    //         data: formData,
    //         success: function (data) {
    //           var value = data.data;
    //           sprint = data.data;
    //           hideloader();
    //           alert('Record Saved Successfully');
    //           masterid = value.itemSaleMasterId
    //           rowData = "";
    //           resetMaster();
    //         },

    //         error: function (request, message, error) {
    //           hideloader();
    //           console.log("error", error);
    //         }
    //       });
    //     }
    //     else {
    //       hideloader();
    //       alert("Please Fill All Form Values");
    //     }
    //   }
    //   else {
    //     hideloader();
    //     alert("Please Add Some Items First");
    //   }
    // }
  </script>

</body>

</html>