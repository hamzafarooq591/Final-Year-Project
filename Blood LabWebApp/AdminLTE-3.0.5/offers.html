<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Alpha Lab Admin Panel</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <style>
    .tableColumnWidth {
      width: 20%;
    }

    [class*=sidebar-dark-] {
      background-color: #143e89;
    }

    .card-primary:not(.card-outline)>.card-header {
      background-color: #ff0107;
    }

    .btn-primary {

      background-color: #ff0107;
      border-color: #ff0107;

    }

    .btn-warning {

      background-color: #ff0107;
      border-color: #ff0107;
      color: #ffff;
    }

    .btn-secondary {

      background-color: #ff0107;
      border-color: #ff0107;

    }

    #overlay {
      position: fixed;
      /* Sit on top of the page content */
      display: none;
      /* Hidden by default */
      width: 100%;
      /* Full width (cover the whole page) */
      height: 100%;
      /* Full height (cover the whole page) */
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      /* Black background with opacity */
      z-index: 2;
      /* Specify a stack order in case you're using a different order for other elements */
      cursor: pointer;
      /* Add a pointer on hover */
    }
  </style>
</head>

<body class="hold-transition sidebar-mini layout-fixed">
  <div id="overlay"  >
    <section class="content" style="margin-top: 85px" id="displayEditDiv">
      <input type="hidden" id="hiddenIDNew">
      <div class="container-fluid">
        <div class="row" style="justify-content: center;">
          <!-- left column -->
          <div class="col-md-6">
            <!-- general form elements -->
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">Edit Offer</h3>
              </div>
              <div class="col-sm-4">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="file:///D:/bloodlabwebapp/AdminLTE-3.0.5/dashboard.html">Dashboard</a></li>
                  <li class="breadcrumb-item active">Offer</li>
                </ol>
              </div>
              <!-- /.card-header -->
              <!-- form start -->
              <div role="form">
                <div class="card-body">
                  <div class="form-group">
                    <label for="txtEditTitle">Title</label>
                    <input type="Text" class="form-control" id="txtEditTitle" placeholder="Enter Test Name">
                  </div>
                  <div class="form-group">
                    <label for="txtEditDescription">Description</label>
                    <input type="text" class="form-control" id="txtEditDescription" placeholder="Enter Description">
                  </div>
                  <div class="form-group">
                    <label for="txtEditOldPrice">Old Price</label>
                    <input type="number" class="form-control" id="txtEditOldPrice" placeholder="Enter Old Price">
                  </div>
                  <div class="form-group">
                    <label for="txtEditNewPrice">New Price</label>
                    <input type="number" class="form-control" id="txtEditNewPrice" placeholder="Enter New Price">
                  </div>
                  <div>
                    <button type="button" class="btn btn-primary px-5" onclick="SaveForm('')">Update</button>
                  </div>
                </div>
              </div>
            </div>
            <!-- /.card -->
          </div>
        </div><!-- /.container-fluid -->
    </section>
  </div>

  <div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <!-- <li class="nav-item d-none d-sm-inline-block">
          <a href="index3.html" class="nav-link">Home</a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="#" class="nav-link">Contact</a>
        </li> -->
      </ul>
      <div class="float-right l-3"  style="width: 100%; text-align: right;">
        <button type="submit" class="btn btn-primary px-4 ml-2" onclick="logout()"><i"> <i class="fas fa-sign-out-alt" style="width: 40px; height:20px;"></i></i></button>
          
          </div>
      <!-- SEARCH FORM -->
      <!-- <form class="form-inline ml-3">
        <div class="input-group input-group-sm">
          <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
          <div class="input-group-append">
            <button class="btn btn-navbar" type="submit">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
      </form> -->
    </nav>
    <!-- /.navbar -->

    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <div id="sideBarContent">

      </div>
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1>Offers</h1>
            </div>
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="file:///D:/bloodlabwebapp/AdminLTE-3.0.5/dashboard.html">Dashboard </a></li>
                <li class="breadcrumb-item active">Offers</li>
              </ol>
            </div>
          </div>
        </div><!-- /.container-fluid -->
      </section>

      <!-- Main content -->
      <section class="content">
        <div class="container-fluid">
          <div class="row">
            <!-- left column -->
            <div class="col-md-12">
              <!-- general form elements -->
              <div class="card card-primary">
                <div class="card-header">
                  <h3 class="card-title">Offers</h3>
                </div>
                <!-- /.card-header -->
                <!-- form start -->
                <div role="form">
                  <div class="card-body">
                    <div class="form-group">
                      <label for="txtTitle">Title</label>
                      <input type="text" class="form-control" id="txtTitle" placeholder="Enter Offer Title">
                    </div>
                    <div class="form-group">
                      <label for="txtDescription">Description</label>
                      <input type="text" class="form-control" id="txtDescription" placeholder="Enter Description">
                    </div>
                    <div class="form-group">
                      <label for="txtOldPrice">Old Price</label>
                      <input type="number" class="form-control" id="txtOldPrice" placeholder="Enter Old Price">
                    </div>
                    <div class="form-group">
                      <label for="txtNewPrice">New Price</label>
                      <input type="number" class="form-control" id="txtNewPrice" placeholder="Enter New Price">
                    </div>
                  </div>
                  <div>
                    <button type="button" class="btn btn-primary px-5 mb-3 ml-3" onclick="SaveForm('add')">Add</button>
                  </div>
              </div>
            </div>
          </div>
          <!-- /.content -->
        </div>

        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">Offer List</h3>

                <div class="card-tools">
                  <div class="input-group input-group-sm" style="width: 150px;">
                    <input type="text" name="table_search" class="form-control float-right" placeholder="Search">

                    <div class="input-group-append">
                      <button type="submit" class="btn btn-default"><i class="fas fa-search"></i></button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- /.card-header -->
              <div class="card-body table-responsive p-0">
                <table class="table table-hover text-nowrap">
                  <thead>
                    <tr>
                      <th class="tableColumnWidth">ID</th>
                      <th class="tableColumnWidth">Title</th>
                      <th class="tableColumnWidth">Old Price</th>
                      <th class="tableColumnWidth">New Price</th>
                      <th class="tableColumnWidth" style="text-align: center;">Action</th>
                    </tr>
                  </thead>
                  <tbody id="offerTableBody">

                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
    </div>
  </div>
    <!-- /.content-wrapper -->
    <footer class="main-footer">
      <div class="float-right d-none d-sm-block">

      </div>
      <strong>Copyright &copy; 2021 <a href="https://nash.pk/">NASH</a>.</strong> All rights
      reserved.
    </footer>
  </div>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
  </div>
  <!-- ./wrapper -->

  <!-- jQuery -->
  <script src="plugins/jquery/jquery.min.js"></script>
  <!-- Bootstrap 4 -->
  <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- bs-custom-file-input -->
  <script src="plugins/bs-custom-file-input/bs-custom-file-input.min.js"></script>
  <!-- AdminLTE App -->
  <script src="dist/js/adminlte.min.js"></script>
  <!-- AdminLTE for demo purposes -->
  <script src="dist/js/demo.js"></script>
  <script src="dist/js/pages/fixContent.js"></script>
  <script type="text/javascript">
    
    var ta = [];
    var rowCounter = 0;
    var currentPage = 1;
    var rowSize = 100;
    var totalPages = 0;
    var companyIdForBranch;
    var rowData = '';
    var tokenValue = localStorage.getItem("SessionKeyFromLogin"); 

    $(document).ready(function () {
      fillList();
    });

    function resetMaster(){
      document.getElementById('txtOldPrice').value = "";
      document.getElementById('txtTitle').value = "";
      document.getElementById('txtNewPrice').value = "";
      document.getElementById('txtDescription').value = "";
    }

    function SaveForm(mode) {
        var id = 0;
        var formData = "";
        if (mode == ""){
            id = document.getElementById('hiddenIDNew').value;
            debugger;
            formData = {
              offerId: id,
              oldPrice: document.getElementById('txtEditOldPrice').value,
              title: document.getElementById('txtEditTitle').value,
              newPrice: document.getElementById('txtEditNewPrice').value,
              description: document.getElementById('txtEditDescription').value,
              createdBy: "string",
              dateCreated: "string",
              dateModified: "string",
              lastModified: "string"
            };
        }
        else{
          debugger
          formData = {
            offerId: id,
            oldPrice: document.getElementById('txtOldPrice').value,
            title: document.getElementById('txtTitle').value,
            newPrice: document.getElementById('txtNewPrice').value,
            description: document.getElementById('txtDescription').value,
            createdBy: "string",
            dateCreated: "string",
            dateModified: "string",
            lastModified: "string"
        };
        }
        var URL = '';
        debugger;
        if (id > 0) {
            URL = nashApi+'/api/Offer/Put/'+ id;
        }
        else {
            URL = nashApi+'/api/Offer';
        }
        $.ajax({
            url: URL,
            type: 'POST',
            dataType: 'json',
            headers: { 'token': tokenValue },
            data: formData,
            success: function (data) {
                var value = data.data;
                fillList();
                overlayOff();
                resetMaster();
            },
            error: function (request, message, error) {
                console.log("error", error);
                overlayOff();
            }
        });
        //Reset form
    }

    function fillList() {
        var URL =  nashApi + '/api/Offer?Size=' + rowSize + "&page=" + currentPage;
        $.ajax({
            url: URL,
            type: 'GET',
            datatype: 'json',
            headers: { 'token': tokenValue },
            success: function (data) {
                console.log(data);
                var OfferTableBody = document.getElementById('offerTableBody');
                if (data.pageCount == 0) {
                    OfferTableBody.innerHTML = '<td colspan="4">No Record Found</td>';
                }
                else {
                    OfferTableBody.innerHTML = '';
                }
                totalPages = data.pageCount;
                $.each(data.data, function (index, value) {
                    var tableRow = document.createElement("tr");
                    var tableCol = document.createElement("td");

                    tableCol.innerHTML = value.offerId;
                    tableRow.appendChild(tableCol);

                    tableCol = document.createElement("td");
                    tableCol.innerHTML = value.title;
                    tableRow.appendChild(tableCol);

                    tableCol = document.createElement("td");
                    tableCol.innerHTML = value.oldPrice;
                    tableRow.appendChild(tableCol);

                    tableCol = document.createElement("td");
                    tableCol.innerHTML = value.newPrice;
                    tableRow.appendChild(tableCol);

                    var buttons = '<button type="button" style="margin-right:5px" class="btn btn-primary px-5 ml-3" onclick="editRow(' + value.offerId + ')"><i class="fa fa-edit"></i></button><button type="button" class="btn btn-secondary px-5" onclick="delRecord(' + value.offerId + ')"><i class="fa fa-trash "></i></button>';
                    tableCol = document.createElement("td");
                    tableCol.innerHTML = buttons;
                    tableRow.appendChild(tableCol);
                    OfferTableBody.append(tableRow);
                });
                // document.getElementById("pagerText").innerHTML = "Page " + currentPage + " of " + totalPages;
            },
            error: function (request, message, error) {
                console.log(error);
            }
        });
    }

    function delRecord(recordId) {
        if (confirm('Are you sure you want to delete this record') == false)
        {
            return;
        }
        $.ajax({
            url:  nashApi + '/api/Offer/Delete/' + recordId,
                type: 'POST',
                headers: { 'token': tokenValue },
                success: function (data) {
                    fillList();
                },
                error: function (request, message, error) {
                    console.log(error);
                }
            });
    }

    function editRow(recordId) {
      debugger
      overlayOn();
      document.getElementById('displayEditDiv').style.display = "block";
      setupForm(recordId);
    }

    function setupForm(recordId) {
      debugger
        //var loc = window.location;
        var recId = recordId;
        if (recId > 0) {
            getRecord(recId);
        }
    }
    function getRecord(recId) {
        $.ajax({
            url: nashApi + '/api/Offer/' + recId, //get
            type: 'GET',
            dataType: 'json',
            headers: { 'token': tokenValue },
            success: function (data) {
                debugger;
                value = data.data;
                document.getElementById('hiddenIDNew').value = value.offerId;
                document.getElementById('txtEditTitle').value = value.title;
                document.getElementById('txtEditOldPrice').value = value.oldPrice;
                document.getElementById('txtEditDescription').value = value.description;
                document.getElementById('txtEditNewPrice').value = value.newPrice;
                //document.getElementById('txtItempurchaseprice').value = Item.purchasePrice;

            },
            error: function (request, message, error) {
                console.log(error);
            }
        });
    }

  </script>
</body>

</html>